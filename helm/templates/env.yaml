# TODO: Split env vars into separate secrets so that each pod
#Â only gets passed the secrets it needs and no more
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ragflow.fullname" . }}-env-config
type: Opaque
stringData:
  {{- .Values.env | toYaml | nindent 2 }}
  # Use host names derived from internal cluster DNS
  REDIS_HOST: {{ printf "%s-redis.%s.svc" (include "ragflow.fullname" .) .Release.Namespace }}
  MYSQL_HOST: {{ printf "%s-mysql.%s.svc" (include "ragflow.fullname" .) .Release.Namespace }}
  {{- if eq .Values.env.DOC_ENGINE "elasticsearch" }}
  ES_HOST: {{ printf "%s-es.%s.svc" (include "ragflow.fullname" .) .Release.Namespace }}
  {{- else if eq .Values.env.DOC_ENGINE "infinity" }}
  INFINITY_HOST: {{ printf "%s-infinity.%s.svc" (include "ragflow.fullname" .) .Release.Namespace }}
  {{- else }}
  {{ fail "env.DOC_ENGINE must be either 'elasticsearch' or 'infinity'" }}
  {{- end }}
  MINIO_HOST: {{ printf "%s-minio.%s.svc" (include "ragflow.fullname" .) .Release.Namespace }}
